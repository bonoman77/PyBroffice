{% extends "layout.html" %}
{% block title %}업체 상세정보{% endblock %}

{% block content %}
<div class="page-header">
  <div>
    <h1 class="page-title">업체 상세정보</h1>
    <nav>
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="/">홈</a></li>
        <li class="breadcrumb-item"><a href="{{ url_for('accounts.client_list') }}">업체관리</a></li>
        <li class="breadcrumb-item active">업체 상세정보</li>
      </ol>
    </nav>
  </div>
</div>

<!-- Profile Header -->
<div class="uview-header">
  <div class="uview-avatar avatar-initial-lg" style="width: 120px; height: 120px; font-size: 3rem;">
    {{ client_info.client_name[0] if client_info else 'C' }}
  </div>
  <div class="uview-info">
    <h2 class="uview-name">{{ client_info.client_name if client_info else '업체' }}</h2>
    <p class="uview-email">{{ client_info.client_business_number or '사업자번호 미등록' }}</p>
    <div class="uview-badges">
      {% if client_info.status == 'active' %}
        <span class="users-status active"><span class="users-status-dot"></span> 활성</span>
      {% else %}
        <span class="users-status inactive"><span class="users-status-dot"></span> 비활성</span>
      {% endif %}
      {% if client_info.cleaning_yn %}<span class="badge bg-success ms-1">청소</span>{% endif %}
      {% if client_info.snack_yn %}<span class="badge bg-warning ms-1">간식</span>{% endif %}
      {% if client_info.office_supplies_yn %}<span class="badge bg-danger ms-1">비품</span>{% endif %}
    </div>
  </div>
</div>

<!-- Content Grid -->
<div class="uview-grid">
  <!-- Main Content -->
  <div>
    <div class="card">
      <div class="card-body">
        <div class="uview-detail-group">
          <div class="uview-detail-title">업체 정보</div>
          <div class="uview-detail-row">
            <div class="uview-detail-label">업체명</div>
            <div class="uview-detail-value">{{ client_info.client_name or '-' }}</div>
          </div>
          <div class="uview-detail-row">
            <div class="uview-detail-label">사업자번호</div>
            <div class="uview-detail-value">{{ client_info.client_business_number or '-' }}</div>
          </div>
          <div class="uview-detail-row">
            <div class="uview-detail-label">업체 연락처</div>
            <div class="uview-detail-value">{{ client_info.client_phone or '-' }}</div>
          </div>
          <div class="uview-detail-row">
            <div class="uview-detail-label">주소</div>
            <div class="uview-detail-value">{{ client_info.client_address or '-' }}</div>
          </div>
          <div class="uview-detail-row">
            <div class="uview-detail-label">계약일</div>
            <div class="uview-detail-value">{{ client_info.contract_date or '-' }}</div>
          </div>
          <div class="uview-detail-row">
            <div class="uview-detail-label">업무 종류</div>
            <div class="uview-detail-value">
              {% if client_info.cleaning_yn %}<span class="badge bg-success">청소</span> {% endif %}
              {% if client_info.snack_yn %}<span class="badge bg-warning">간식</span> {% endif %}
              {% if client_info.office_supplies_yn %}<span class="badge bg-danger">비품</span> {% endif %}
              {% if not client_info.cleaning_yn and not client_info.snack_yn and not client_info.office_supplies_yn %}-{% endif %}
            </div>
          </div>
          <div class="uview-detail-row">
            <div class="uview-detail-label">등록일</div>
            <div class="uview-detail-value">{{ client_info.create_date or '-' }}</div>
          </div>
          {% if client_info.memo %}
          <div class="uview-detail-row">
            <div class="uview-detail-label">비고</div>
            <div class="uview-detail-value">{{ client_info.memo }}</div>
          </div>
          {% endif %}
        </div>

        <!-- 업체 담당자 목록 -->
        <div class="uview-detail-group">
          <div class="uview-detail-title">업체 담당자 ({{ client_users|length }}명)</div>
          {% if client_users %}
          <div class="table-responsive">
            <table class="table table-sm table-hover mb-0">
              <thead>
                <tr>
                  <th>이름</th>
                  <th>이메일</th>
                  <th>연락처</th>
                  <th>상태</th>
                  <th>등록일</th>
                </tr>
              </thead>
              <tbody>
                {% for u in client_users %}
                <tr>
                  <td>
                    <a href="{{ url_for('accounts.user_detail', user_id=u.user_id) }}" class="fw-semibold text-decoration-none">{{ u.user_name }}</a>
                  </td>
                  <td class="text-muted small">{{ u.user_email or '-' }}</td>
                  <td>{{ u.user_mobile or '-' }}</td>
                  <td>
                    {% if u.status == 'active' %}
                    <span class="badge bg-success">활성</span>
                    {% elif u.status == 'pending' %}
                    <span class="badge bg-warning">대기</span>
                    {% else %}
                    <span class="badge bg-secondary">비활성</span>
                    {% endif %}
                  </td>
                  <td class="text-muted small">{{ u.create_date }}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          {% else %}
          <div class="text-center text-muted py-3">
            <p class="mb-0 small">연결된 담당자가 없습니다.</p>
          </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  <!-- Sidebar -->
  <div>
    <!-- 관리팀장 정보 -->
    <div class="card">
      <div class="card-header">
        <h5 class="card-title mb-0">관리팀장</h5>
      </div>
      <div class="card-body">
        <div class="uview-status-list">
          <div class="uview-status-item">
            <span class="uview-status-label">이름</span>
            <span class="uview-status-value fw-semibold">{{ client_info.manager_name }}</span>
          </div>
          {% if client_info.manager_mobile %}
          <div class="uview-status-item">
            <span class="uview-status-label">연락처</span>
            <span class="uview-status-value">{{ client_info.manager_mobile }}</span>
          </div>
          {% endif %}
          {% if client_info.manager_email %}
          <div class="uview-status-item">
            <span class="uview-status-label">이메일</span>
            <span class="uview-status-value small">{{ client_info.manager_email }}</span>
          </div>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- 계약자 정보 (기존 데이터 있으면 표시) -->
    {% if client_info.contractor_name %}
    <div class="card mt-3">
      <div class="card-header">
        <h5 class="card-title mb-0">계약자 정보</h5>
      </div>
      <div class="card-body">
        <div class="uview-status-list">
          <div class="uview-status-item">
            <span class="uview-status-label">이름</span>
            <span class="uview-status-value">{{ client_info.contractor_name }}{% if client_info.contractor_position %} ({{ client_info.contractor_position }}){% endif %}</span>
          </div>
          {% if client_info.contractor_mobile %}
          <div class="uview-status-item">
            <span class="uview-status-label">연락처</span>
            <span class="uview-status-value">{{ client_info.contractor_mobile }}</span>
          </div>
          {% endif %}
        </div>
      </div>
    </div>
    {% endif %}
  </div>
  
  <!-- Navigation -->
  <div class="mt-3">
    <nav class="d-flex justify-content-between">
      <a href="javascript:history.back()" class="btn btn-outline-secondary">
        <i class="bi bi-arrow-left me-1"></i> 뒤로가기
      </a>
    </nav>
  </div>
</div>
{% endblock %}
