{% extends "layout.html" %}
{% from "macros/form.html" import input, password_toggle %}
{% block title %}회원목록{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="page-header">
  <div>
    <h1 class="page-title">회원목록</h1>
    <nav>
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="/">홈</a></li>
        <li class="breadcrumb-item">회원관리</li>
        <li class="breadcrumb-item active">회원목록</li>
      </ol>
    </nav>
  </div>
</div>

<!-- User Stats Strip -->
<div class="users-stats">
  <div class="users-stat-card">
    <div class="users-stat-icon primary"><i class="ph-duotone ph-users-three"></i></div>
    <div class="users-stat-body">
      <div class="users-stat-value">{{ total_users|default(0) }}</div>
      <div class="users-stat-label">전체 회원</div>
    </div>
  </div>
  <div class="users-stat-card">
    <div class="users-stat-icon success"><i class="ph-duotone ph-user-check"></i></div>
    <div class="users-stat-body">
      <div class="users-stat-value">{{ active_users|default(0) }}</div>
      <div class="users-stat-label">활성</div>
    </div>
  </div>
  <div class="users-stat-card">
    <div class="users-stat-icon warning"><i class="ph-duotone ph-clock-countdown"></i></div>
    <div class="users-stat-body">
      <div class="users-stat-value">{{ pending_users|default(0) }}</div>
      <div class="users-stat-label">대기</div>
    </div>
  </div>
  <div class="users-stat-card">
    <div class="users-stat-icon danger"><i class="ph-duotone ph-user-minus"></i></div>
    <div class="users-stat-body">
      <div class="users-stat-value">{{ inactive_users|default(0) }}</div>
      <div class="users-stat-label">비활성</div>
    </div>
  </div>
</div>

<!-- Users Table Card -->
<div class="card">
  <div class="users-toolbar">
    <div class="users-toolbar-left">
      <div class="users-search">
        <i class="ph ph-magnifying-glass"></i>
        <input type="text" placeholder="회원 검색..." id="userSearch">
      </div>
      <div class="users-filter-group">
        <div class="dropdown">
          <button class="users-filter-btn" data-bs-toggle="dropdown">
            <i class="ph ph-funnel"></i> 역할
            <i class="ph ph-caret-down"></i>
          </button>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item active" href="#" data-filter="role" data-value="all">전체 역할</a></li>
            <li><a class="dropdown-item" href="#" data-filter="role" data-value="admin">관리자</a></li>
            <li><a class="dropdown-item" href="#" data-filter="role" data-value="staff">현장직원</a></li>
            <li><a class="dropdown-item" href="#" data-filter="role" data-value="client">업체담당자</a></li>
          </ul>
        </div>
        <div class="dropdown">
          <button class="users-filter-btn" data-bs-toggle="dropdown">
            <i class="ph ph-circle-half"></i> 상태
            <i class="ph ph-caret-down"></i>
          </button>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item active" href="#" data-filter="status" data-value="all">전체 상태</a></li>
            <li><a class="dropdown-item" href="#" data-filter="status" data-value="active">활성</a></li>
            <li><a class="dropdown-item" href="#" data-filter="status" data-value="pending">대기</a></li>
            <li><a class="dropdown-item" href="#" data-filter="status" data-value="inactive">비활성</a></li>
          </ul>
        </div>
      </div>
    </div>
    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addUserModal">
      <i class="ph ph-plus me-1"></i> 회원 추가
    </button>
  </div>

  <div class="users-table-wrap">
    <table class="users-table">
      <thead>
        <tr>
          <th class="users-th-check">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="selectAll">
            </div>
          </th>
          <th>회원</th>
          <th>역할</th>
          <th>연락처</th>
          <th>상태</th>
          <th>등록일</th>
          <th class="users-th-actions">작업</th>
        </tr>
      </thead>
      <tbody>
        {% if users %}
          {% for user in users %}
          <tr>
            <td>
              <div class="form-check"><input class="form-check-input" type="checkbox"></div>
            </td>
            <td>
              <div class="users-cell-user">
                <div>
                  <a href="{{ url_for('accounts.user_detail', user_id=user.user_id) }}" class="users-cell-name">{{ user.user_name }}</a>
                  <div class="users-cell-email">{{ user.user_email }}</div>
                </div>
              </div>
            </td>

            <td>
              {% if user.role == 'admin' %}
              <span class="badge bg-danger">관리자</span>
              {% elif user.role == 'staff' %}
              <span class="badge bg-success">현장직원</span>
              {% elif user.role == 'client' %}
              <div>
                {% if user.client_name %}
                  <span class="badge bg-primary">{{ user.client_name }}</span>
                {% else %}
                  <span class="badge bg-primary">업체담당자</span>
                {% endif %}
              </div>
              {% else %}
              <span class="badge bg-secondary">일반</span>
              {% endif %}
            </td>
            <td>
              {{ user.user_mobile|default('-') }}
            </td>
            <td>
              {% if user.status == 'active' %}
              <span class="users-status active"><span class="users-status-dot"></span> 활성</span>
              {% elif user.status == 'pending' %}
              <span class="users-status pending"><span class="users-status-dot"></span> 대기</span>
              {% else %}
              <span class="users-status inactive"><span class="users-status-dot"></span> 비활성</span>
              {% endif %}
            </td>
            <td class="users-cell-meta">{{ user.created_at|datetime_str('simple')|default('알 수 없음') }}</td>
            <td>
              <div class="table-actions justify-content-end">
                <!-- <button class="btn btn-icon btn-sm btn-light" title="보기"><i class="bi bi-eye"></i></button> -->
                <button class="btn btn-icon btn-sm btn-light edit-user-btn" title="수정" 
                        data-user-id="{{ user.user_id }}"
                        data-user-name="{{ user.user_name }}"
                        data-user-email="{{ user.user_email }}"
                        data-user-mobile="{{ user.user_mobile }}"
                        data-user-kind-id="{{ user.user_kind_id }}"
                        data-client-id="{{ user.client_id|default('') }}"
                        data-status="{{ user.status }}"><i class="bi bi-pencil"></i></button>
                <button class="btn btn-icon btn-sm btn-light" title="삭제" data-user-id="{{ user.user_id }}" data-user-name="{{ user.user_name }}" onclick="showDeleteModal(this)"><i class="bi bi-trash"></i></button>
              </div>
            </td>
          </tr>
          {% endfor %}
        {% else %}
          <tr>
            <td colspan="8" class="text-center py-5">
              <div class="text-muted">
                <i class="ph ph-users-three" style="font-size: 48px; opacity: 0.3;"></i>
                <p class="mt-3 mb-0">등록된 회원이 없습니다.</p>
              </div>
            </td>
          </tr>
        {% endif %}
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <div class="users-pagination" id="usersPagination" style="display: none;">
    <div class="users-pagination-info" id="paginationInfo">
      Showing <strong id="showingRange">1-10</strong> of <strong id="totalCount">0</strong> users
    </div>
    <nav>
      <ul class="pagination mb-0" id="paginationList">
        <!-- 페이지 버튼이 동적으로 생성됩니다 -->
      </ul>
    </nav>
  </div>
</div>

<!-- Add User Modal -->
<div class="modal fade" id="addUserModal" tabindex="-1" aria-labelledby="addUserModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="addUserModalLabel">회원 추가</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="alert alert-warning" role="alert">
          
          <strong>주의:</strong> 관리자가 직접 등록하는 회원은 이용약관 및 개인정보처리방침 동의 절차 없이 가입됩니다.
        </div>
        <form id="addUserForm" action="{{ url_for('accounts.user_admin_insert_post') }}" method="post">
          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="userName" class="form-label">이름 <span class="text-danger">*</span></label>
              {{ input('text', 'userName', '', opt='required') }}
            </div>
            <div class="col-md-6 mb-3">
              <label for="userEmail" class="form-label">이메일 (계정) <span class="text-danger">*</span></label>
              {{ input('email', 'userEmail', '', opt='required') }}
            </div>
          </div>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="userMobile" class="form-label">연락처 <span class="text-danger">*</span></label>
              {{ input('tel', 'userMobile', '', placeholder='010-0000-0000', opt='required') }}
            </div>
            <div class="col-md-6 mb-3">
              <label for="userStatus" class="form-label">상태</label>
              <select class="form-select" id="userStatus" name="userStatus">
                <option value="active" selected>활성</option>
                <option value="pending">대기</option>
                <option value="inactive">비활성</option>
              </select>
            </div>
          </div>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="userKindId" class="form-label">역할 <span class="text-danger">*</span></label>
              <select class="form-select" id="userKindId" name="userKindId" required>
                <option value="">선택하세요</option>
                <option value="1">관리자</option>
                <option value="2">현장직원</option>
                <option value="3">업체담당자</option>
              </select>
            </div>
            <div class="col-md-6 mb-3">
              <div class="form-group" id="addClientSelectGroup" style="display: none;">
                <label for="clientId" class="form-label">소속 업체</label>
                <select class="form-select" id="clientId" name="clientId">
                  <option value="">선택하세요</option>
                </select>
                <div class="form-text">업체담당자인 경우 소속 업체를 선택하세요.</div>
              </div>
            </div>
          </div>
          <div class="mb-3">
            <label for="userPasswd" class="form-label">비밀번호 <span class="text-danger">*</span></label>
            {{ password_toggle('userPasswd', '', placeholder='비밀번호를 입력하세요', min='8', opt='required') }}
            <div class="form-text">최소 8자 이상 입력해주세요.</div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
        <button type="button" class="btn btn-primary" onclick="submitAddUser()">추가</button>
      </div>
    </div>
  </div>
</div>

<!-- Delete User Modal -->
<div class="modal fade" id="deleteUserModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-body text-center py-4">
        <div class="mb-3">
          <span class="bg-danger-subtle text-danger rounded-circle d-inline-flex align-items-center justify-content-center" style="width: 64px; height: 64px;">
            <i class="bi bi-exclamation-triangle fs-1"></i>
          </span>
        </div>
        <h5>회원 삭제</h5>
        <p class="text-muted mb-2">정말로 <strong id="deleteUserName"></strong> 회원을 삭제하시겠습니까?</p>
        <p class="text-muted mb-0 small">이 작업은 되돌릴 수 없습니다.</p>
        <input type="hidden" id="deleteUserId">
      </div>
      <div class="modal-footer justify-content-center border-0 pt-0">
        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">취소</button>
        <button type="button" class="btn btn-danger" onclick="confirmDeleteUser()">삭제</button>
      </div>
    </div>
  </div>
</div>

<!-- Edit User Modal -->
<div class="modal fade" id="editUserModal" tabindex="-1" aria-labelledby="editUserModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="editUserModalLabel">회원 정보 수정</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="editUserForm" action="{{ url_for('accounts.user_admin_update_post') }}" method="post">
          <input type="hidden" id="editUserId" name="userId">
          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="editUserName" class="form-label">이름 <span class="text-danger">*</span></label>
              {{ input('text', 'editUserName', '', opt='required') }}
            </div>
            <div class="col-md-6 mb-3">
              <label for="editUserEmail" class="form-label">이메일 (계정) <span class="text-danger">*</span></label>
              {{ input('email', 'editUserEmail', '', opt='required disabled') }}
              <div class="form-text">이메일은 변경할 수 없습니다.</div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="editUserMobile" class="form-label">연락처 <span class="text-danger">*</span></label>
              {{ input('tel', 'editUserMobile', '', placeholder='010-0000-0000', opt='required') }}
            </div>
            <div class="col-md-6 mb-3">
              <label for="editUserStatus" class="form-label">상태</label>
              <select class="form-select" id="editUserStatus" name="editUserStatus">
                <option value="active">활성</option>
                <option value="pending">대기</option>
                <option value="inactive">비활성</option>
              </select>
            </div>
          </div>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="editUserKindId" class="form-label">역할 <span class="text-danger">*</span></label>
              <select class="form-select" id="editUserKindId" name="editUserKindId" required>
                <option value="">선택하세요</option>
                <option value="1">관리자</option>
                <option value="2">현장직원</option>
                <option value="3">업체담당자</option>
              </select>
            </div>
            <div class="col-md-6 mb-3">
              <div class="form-group" id="editClientSelectGroup" style="display: none;">
                <label for="editClientId" class="form-label">소속 업체</label>
                <select class="form-select" id="editClientId" name="editClientId">
                  <option value="">선택하세요</option>
                </select>
                <div class="form-text">업체담당자인 경우 소속 업체를 선택하세요.</div>
              </div>
            </div>
          </div>
          <div class="mb-3">
            <label for="editUserPasswd" class="form-label">비밀번호</label>
            {{ password_toggle('editUserPasswd', '', placeholder='변경하지 않으려면 비워두세요', min='8', opt='') }}
            <div class="form-text">비밀번호를 변경하려면 입력하세요 (최소 8자). 비워두면 기존 비밀번호 유지됩니다.</div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
        <button type="button" class="btn btn-primary" onclick="submitEditUser()">수정</button>
      </div>
    </div>
  </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
// 페이징 인스턴스 생성 (커스텀 필터 포함)
const userPagination = new TablePagination({
  tableSelector: '.users-table tbody',
  paginationSelector: '#usersPagination',
  itemsPerPage: 10
});

// 커스텀 필터 함수 정의
userPagination.customFilter = function(row, filters) {
  // 역할 필터
  if (filters.role && filters.role !== 'all') {
    const roleElements = row.querySelectorAll('.badge');
    if (roleElements.length > 0) {
      let roleType = '';
      let found = false;
      
      roleElements.forEach(element => {
        const roleText = element.textContent;
        
        if (roleText.includes('관리자')) {
          roleType = 'admin';
          found = true;
        } else if (roleText.includes('현장직원')) {
          roleType = 'staff';
          found = true;
        } else if (roleText.includes('업체담당자')) {
          roleType = 'client';
          found = true;
        }
      });
      
      // 업체담당자인데 업체명만 표시된 경우
      if (!found && roleElements.length === 1) {
        const roleText = roleElements[0].textContent;
        if (!roleText.includes('관리자') && !roleText.includes('현장직원') && !roleText.includes('일반')) {
          roleType = 'client';
          found = true;
        }
      }
      
      if (!found || roleType !== filters.role) return false;
    }
  }
  
  // 상태 필터
  if (filters.status && filters.status !== 'all') {
    const statusElement = row.querySelector('.users-status');
    if (statusElement) {
      const statusClass = statusElement.className;
      let statusType = '';
      if (statusClass.includes('active')) statusType = 'active';
      else if (statusClass.includes('pending')) statusType = 'pending';
      else if (statusClass.includes('inactive')) statusType = 'inactive';
      
      if (statusType !== filters.status) return false;
    }
  }
  
  return true;
};

// Select All Checkbox
document.getElementById('selectAll')?.addEventListener('change', function() {
  const checkboxes = document.querySelectorAll('.users-table tbody input[type="checkbox"]');
  checkboxes.forEach(cb => cb.checked = this.checked);
});

// 검색 기능
document.getElementById('userSearch')?.addEventListener('input', function(e) {
  userPagination.applySearchFilter(e.target.value, ['.users-cell-name', '.users-cell-email']);
});

// 필터 기능
document.querySelectorAll('[data-filter]').forEach(item => {
  item.addEventListener('click', function(e) {
    e.preventDefault();
    const filterType = this.dataset.filter;
    const filterValue = this.dataset.value;
    
    // 활성 상태 업데이트
    this.closest('.dropdown-menu').querySelectorAll('.dropdown-item').forEach(i => {
      i.classList.remove('active');
    });
    this.classList.add('active');
    
    // 필터 적용
    userPagination.setFilter(filterType, filterValue);
  });
});

// Add User Form Submit
function submitAddUser() {
  const form = document.getElementById('addUserForm');
  if (form.checkValidity()) {
    form.submit();
  } else {
    form.reportValidity();
  }
}

// 추가 모달에서 역할 변경 시 처리
document.getElementById('userKindId')?.addEventListener('change', function() {
  handleAddClientSelect(this.value);
  if (this.value === '3') {
    loadAddClients();
  }
});

// 추가 모달 업체 선택 처리
function handleAddClientSelect(userKindId) {
  const clientSelectGroup = document.getElementById('addClientSelectGroup');
  
  if (userKindId === '3') { // 업체담당자
    clientSelectGroup.style.display = 'block';
  } else {
    clientSelectGroup.style.display = 'none';
    document.getElementById('clientId').value = '';
  }
}

// 추가 모달 업체 목록 로드
async function loadAddClients() {
  try {
    const response = await fetch('/accounts/api/clients');
    
    const clients = await response.json();
    
    const clientId = document.getElementById('clientId');
    clientId.innerHTML = '<option value="">선택하세요</option>';
    
    clients.forEach(client => {
      const option = document.createElement('option');
      option.value = client.client_id;
      option.textContent = client.client_name;
      clientId.appendChild(option);
    });
  } catch (error) {
    console.error('추가 모달 업체 목록 로드 실패:', error);
  }
}

// Edit User - Load data into modal
document.querySelectorAll('.edit-user-btn').forEach(button => {
  button.addEventListener('click', function() {
    const userId = this.dataset.userId;
    const userName = this.dataset.userName;
    const userEmail = this.dataset.userEmail;
    const userMobile = this.dataset.userMobile;
    const userKindId = this.dataset.userKindId;
    const status = this.dataset.status;
    const clientId = this.dataset.clientId || '';
    
    // Populate form fields
    document.getElementById('editUserId').value = userId;
    document.getElementById('editUserName').value = userName;
    document.getElementById('editUserEmail').value = userEmail;
    document.getElementById('editUserMobile').value = userMobile;
    document.getElementById('editUserKindId').value = userKindId;
    document.getElementById('editUserStatus').value = status;
    document.getElementById('editClientId').value = clientId;
    
    // 업체 선택 필드 표시/숨김 처리
    handleEditClientSelect(userKindId);
    
    // 업체 목록 로드 (필요한 경우)
    if (userKindId === '3') {
      loadEditClients(clientId);
    }
    
    // Show modal
    const modal = new bootstrap.Modal(document.getElementById('editUserModal'));
    modal.show();
  });
});

// 수정 모달 업체 선택 처리
function handleEditClientSelect(userKindId) {
  const clientSelectGroup = document.getElementById('editClientSelectGroup');
  
  if (userKindId === '3') { // 업체담당자
    clientSelectGroup.style.display = 'block';
  } else {
    clientSelectGroup.style.display = 'none';
    document.getElementById('editClientId').value = '';
  }
}

// 수정 모달 업체 목록 로드
async function loadEditClients(selectedClientId = '') {
  try {
    const response = await fetch('/accounts/api/clients');
    const clients = await response.json();
    
    const editClientId = document.getElementById('editClientId');
    editClientId.innerHTML = '<option value="">선택하세요</option>';
    
    clients.forEach(client => {
      const option = document.createElement('option');
      option.value = client.client_id;
      option.textContent = client.client_name;
      if (selectedClientId && client.client_id == selectedClientId) {
        option.selected = true;
      }
      editClientId.appendChild(option);
    });
  } catch (error) {
    console.error('업체 목록 로드 실패:', error);
  }
}

// 수정 모달에서 역할 변경 시 처리
document.getElementById('editUserKindId')?.addEventListener('change', function() {
  handleEditClientSelect(this.value);
  if (this.value === '3') {
    loadEditClients();
  }
});

// Edit User Form Submit
function submitEditUser() {
  const form = document.getElementById('editUserForm');
  if (form.checkValidity()) {
    const formData = new FormData(form);
    
    fetch(form.action, {
      method: 'POST',
      body: formData
    })
    .then(response => {
      if (response.redirected) {
        // 서버에서 리다이렉트 응답이 오면 페이지 새로고침
        window.location.href = response.url;
      } else {
        // 리다이렉트가 없으면 현재 페이지 새로고침
        window.location.reload();
      }
    })
    .catch(error => {
      console.error('수정 실패:', error);
      showToast('danger', '회원 정보 수정에 실패했습니다.');
    });
  } else {
    form.reportValidity();
  }
}

// Delete User - Show confirmation modal
function showDeleteModal(button) {
  const userId = button.dataset.userId;
  const userName = button.dataset.userName;
  
  document.getElementById('deleteUserId').value = userId;
  document.getElementById('deleteUserName').textContent = userName;
  
  const modal = new bootstrap.Modal(document.getElementById('deleteUserModal'));
  modal.show();
}

// Delete User - Confirm deletion
function confirmDeleteUser() {
  const userId = document.getElementById('deleteUserId').value;
  
  // AJAX 요청으로 회원 삭제
  fetch("{{ url_for('accounts.user_admin_delete_post') }}", {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'X-Requested-With': 'XMLHttpRequest'
    },
    body: JSON.stringify({ user_id: userId })
  })
  .then(response => response.json())
  .then(data => {
    // Close modal
    const modal = bootstrap.Modal.getInstance(document.getElementById('deleteUserModal'));
    modal.hide();
    
    if (data.success) {
      showToast('success', data.message || '회원이 삭제되었습니다.');
      setTimeout(() => location.reload(), 1000);
    } else {
      showToast('danger', data.error || '회원 삭제에 실패했습니다.');
    }
  })
  .catch(error => {
    console.error('Error:', error);
    showToast('danger', '회원 삭제 중 오류가 발생했습니다.');
  });
}

// Toast 알림 함수
function showToast(type, message) {
  const toastContainer = document.getElementById('toastContainer') || createToastContainer();
  const toastId = 'toast-' + Date.now();
  
  const toastHtml = `
    <div id="${toastId}" class="toast align-items-center text-white bg-${type} border-0" role="alert" aria-live="assertive" aria-atomic="true">
      <div class="d-flex">
        <div class="toast-body">
          ${message}
        </div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
      </div>
    </div>
  `;
  
  toastContainer.insertAdjacentHTML('beforeend', toastHtml);
  const toastElement = document.getElementById(toastId);
  const toast = new bootstrap.Toast(toastElement, { delay: 3000 });
  toast.show();
  
  toastElement.addEventListener('hidden.bs.toast', () => toastElement.remove());
}

function createToastContainer() {
  const container = document.createElement('div');
  container.id = 'toastContainer';
  container.className = 'toast-container position-fixed top-0 end-0 p-3';
  container.style.zIndex = '1050';
  document.body.appendChild(container);
  return container;
}

// Password Toggle for Edit Modal
document.addEventListener('DOMContentLoaded', function() {
  document.querySelectorAll('[data-toggle-password]').forEach(button => {
    button.addEventListener('click', function() {
      const input = this.parentElement.querySelector('input');
      const icon = this.querySelector('i');
      
      if (input.type === 'password') {
        input.type = 'text';
        icon.classList.remove('ph-eye');
        icon.classList.add('ph-eye-slash');
      } else {
        input.type = 'password';
        icon.classList.remove('ph-eye-slash');
        icon.classList.add('ph-eye');
      }
    });
  });
});
</script>
{% endblock %}
