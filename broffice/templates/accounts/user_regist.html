{% extends "layout_login.html" %}

{% from "macros/form.html" import input %}

{% block title %}회원가입{% endblock %}

{% block auth_content %}
<div class="auth-card-header">
  <h1 class="auth-title">회원가입</h1>
  <p class="auth-subtitle">브로피스에 오신 것을 환영합니다</p>
</div>

<form class="auth-form" id="registerForm" method="POST" action="{{ url_for('accounts.user_regist_post') }}">
  <div class="row">
    <div class="col-md-6">
      <div class="form-group">
        <label for="userName" class="form-label">사용자명 <span class="text-danger">*</span></label>
        {{ input('text', 'userName', '', placeholder='이름을 입력하세요', opt='required') }}
        <div class="invalid-feedback">사용자명을 입력해주세요.</div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="form-group">
        <label for="userKindId" class="form-label">사용자 타입 <span class="text-danger">*</span></label>
        <select class="form-select" id="userKindId" name="userKindId" required>
          <option value="">선택하세요</option>
          <option value="2">현장직원</option>
          <option value="3">업체담당자</option>
        </select>
        <div class="invalid-feedback">사용자 타입을 선택해주세요.</div>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-md-12">
      <label for="userEmail" class="form-label">이메일 계정 <span class="text-danger">*</span></label>
      {{ input('email', 'userEmail', '', placeholder='이메일 계정을 입력하세요', opt='required') }}
      <div class="form-text">로그인 시 사용할 이메일 계정입니다.</div>
      <div class="invalid-feedback">이메일 계정을 입력해주세요.</div>
    </div>
  </div>

  <div class="row">
    <div class="col-md-6">
      <div class="form-group">
        <label for="userMobile" class="form-label">연락처 <span class="text-danger">*</span></label>
        {{ input('tel', 'userMobile', '', placeholder='010-0000-0000', opt='required') }}
        <div class="invalid-feedback">연락처를 입력해주세요.</div>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-md-6">
      <div class="form-group">
        <label for="userPasswd" class="form-label">비밀번호 <span class="text-danger">*</span></label>
        <div class="input-group">
          <input type="password" class="form-control" id="userPasswd" name="userPasswd" placeholder="비밀번호를 입력하세요" required minlength="8">
          <button class="btn btn-outline-secondary" type="button" data-toggle-password>
            <i class="ph ph-eye"></i>
          </button>
          <div class="invalid-feedback">비밀번호는 최소 8자 이상이어야 합니다.</div>
        </div>
        <div class="form-text">최소 8자 이상 입력해주세요.</div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="form-group">
        <label for="userPasswdConfirm" class="form-label">비밀번호 확인 <span class="text-danger">*</span></label>
        <div class="input-group">
          <input type="password" class="form-control" id="userPasswdConfirm" name="userPasswdConfirm" placeholder="비밀번호를 다시 입력하세요" required minlength="8">
          <button class="btn btn-outline-secondary" type="button" data-toggle-password>
            <i class="ph ph-eye"></i>
          </button>
          <div class="invalid-feedback">비밀번호가 일치하지 않습니다.</div>
        </div>
      </div>
    </div>
  </div>

  <div class="form-check">
    <input class="form-check-input" type="checkbox" id="terms" name="terms" required>
    <label class="form-check-label" for="terms">
      <a href="{{ url_for('homes.terms') }}" class="auth-link" target="_blank">이용약관</a> 및 <a href="{{ url_for('homes.privacy') }}" class="auth-link" target="_blank">개인정보처리방침</a>에 동의합니다
    </label>
    <div class="invalid-feedback">약관에 동의해주세요.</div>
  </div>

  <button type="submit" class="btn btn-primary btn-block">가입하기</button>
</form>

<p class="auth-footer-text">
  이미 계정이 있으신가요? <a href="{{ url_for('accounts.login') }}" class="auth-link">로그인</a>
</p>

{% endblock %}

{% block extra_js %}
<script>
  // Password Toggle
  document.querySelectorAll('[data-toggle-password]').forEach(button => {
    button.addEventListener('click', function() {
      const input = this.parentElement.querySelector('input');
      const icon = this.querySelector('i');
      
      if (input.type === 'password') {
        input.type = 'text';
        icon.classList.remove('ph-eye');
        icon.classList.add('ph-eye-slash');
      } else {
        input.type = 'password';
        icon.classList.remove('ph-eye-slash');
        icon.classList.add('ph-eye');
      }
    });
  });

  // Form Validation
  const form = document.getElementById('registerForm');
  form.addEventListener('submit', function(event) {
    const password = document.getElementById('userPasswd').value;
    const passwordConfirm = document.getElementById('userPasswdConfirm').value;
    const termsChecked = document.getElementById('terms').checked;
    
    // Check terms agreement
    if (!termsChecked) {
      event.preventDefault();
      event.stopPropagation();
      document.getElementById('terms').setCustomValidity('이용약관 및 개인정보처리방침에 동의해야 합니다.');
    } else {
      document.getElementById('terms').setCustomValidity('');
    }
    
    // Check password match
    if (password !== passwordConfirm) {
      event.preventDefault();
      event.stopPropagation();
      document.getElementById('userPasswdConfirm').setCustomValidity('비밀번호가 일치하지 않습니다.');
    } else {
      document.getElementById('userPasswdConfirm').setCustomValidity('');
    }
    
    if (!form.checkValidity()) {
      event.preventDefault();
      event.stopPropagation();
    }
    
    form.classList.add('was-validated');
  }, false);

  // Reset custom validity on input
  document.getElementById('userPasswdConfirm').addEventListener('input', function() {
    this.setCustomValidity('');
  });
  
  // Reset terms validity on change
  document.getElementById('terms').addEventListener('change', function() {
    this.setCustomValidity('');
  });
</script>
{% endblock %}

